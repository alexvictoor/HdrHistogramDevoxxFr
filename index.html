<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/serif.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<style>

			html.img-left div.slide-background.present {
    		background-position: left;
			}

			table.schema, th, table.schema td {
   			border: 1px solid black;
			}

			table.no_border td {
   			border-bottom: 0px;
			}


			/* intro slides */
			html.intro .slides {
				background-image: url("background_1280_720_HD.png"); }

			html.intro .reveal .slides section h1, html.intro .reveal .slides section h2 {
				padding-top: 12%;
				padding-left: 6%;
				padding-right: 6%;
				text-align: left;
				border-bottom: none; }

			html.intro .reveal .slides section p {
				text-align: left;
				margin-left: 12%;
				margin-right: 12%; }

			html.intro .footer {
				z-index: 100;
				background-image: none;
				background-color: #057ffa; }

			html.intro h2, html.intro h3, html.intro p {
				color: white;
			}

			/* devoxx footer */
			.footer {
				position:absolute;
				bottom: 0px;
				width: 100%;
				height: 49px;
				background-image: url("../../bandeau_bas.png");
				background-position: center top; }

			.footer img {
				position: absolute;
				top: 0px;
				right: 0px; }

			.footer p {
				margin: 0px;
				text-align: left;
				padding-left: 10px;
				font-size: 1em;
				font-weight: bold }	

						
			mark {
				opacity: 0.2;
				background-color: #3f3f3f; }

			
			.simple_arrow {
				background-size: 70% 100%; 
				background-repeat: no-repeat;
				background-image: "hand-drawn-arrow-2.png";
			}

			.reveal section img.no_border_img {
				border: 0px; 
				box-shadow: 0 0 0 0;
			}


		</style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">


<section data-state="intro">
	<h2>HdrHistogram</h2>
	<h3>l'outil indispensable pour mesurer la latence</h3>
	<aside class="notes">
		Qui mesure ces temps de réponses
		sondage qui a déjà utilisé HdrHistogram ?
		une autre implem d'histogram, celle d'elasticsearch ou metrics de codahale ?
	</aside>
</section>

<section data-state="intro">
	<h2>MYSELF</h2>
	<p style="text-align: left;">
		Alexandre Victoor<br/>
		Architecte à la SGCIB<br/>
		alexvictoor@gmail.com<br/>
		https://github.com/alexvictoor<br/>
		@alex_victoor
	</p>
		<aside class="notes">
		HdrHistogram porté en JavaScript
	</aside>
</section>
<section data-background="gil-tene-java.jpg" data-background-size="40%">
	<h3>&nbsp;</h3>
	<h3>&nbsp;</h3>
	<h3>&nbsp;</h3>
	<h3>&nbsp;</h3>
	<h3>
		<span style="color: red; background-color: black">@giltene</span>
	</h3>
</section>
<section>
	<h3>HdrHistogram</h3>
	<img src="golang.png" width="10%" class="no_border_img fragment fade-up" data-fragment-index="1"/>
	<img src="python.png" width="13%" class="no_border_img fragment fade-up" data-fragment-index="1"/>
	<img src="The_C_Programming_Language_logo.svg.png" width="13%" class="no_border_img fragment fade-up" data-fragment-index="1"/>
	<img src="Duke-Guitar.png" width="20%" class="no_border_img" />
	<img src="csharp.png" width="13%" class="no_border_img fragment fade-up" data-fragment-index="1"/>
	<img src="Erlang_logo.svg.png" width="13%" class="no_border_img fragment fade-up" data-fragment-index="1"/>
	<img src="Rust_programming_language_black_logo.svg.png" width="13%" class="no_border_img fragment fade-up" data-fragment-index="1"/>
	<img src="Unofficial_JavaScript_logo_2.svg.png" width="13%" class="no_border_img fragment fade-up" data-fragment-index="1"/>
	<aside class="notes">
		HdrHistogram permet de gérer des histograms, des statistiques sur des temps de réponses et du comportement d'un ssystème
		Java et d'autre technos
	</aside>
</section>

<section data-background="_Time_-_is_money_095207_.jpg">
	
	<h3 style="background-color: black; color: red; font-weight: bold">Every 100ms of latency costs Amazon 1% of profit</h3>
	
	<aside class="notes">
		http://www.zastavki.com/pictures/originals/2015/_Time_-_is_money_095207_.jpg
		Pourquoi je vous parle aujourd'hui de latence ?
		corrélation entre latence et chiffre d'affaire
		finance, la latence ça parle au métier
	  pour savoir si on répond au besoin, si on respect un niveau de service, un SLA, pas de secret il faut mesurer
	</aside>
</section>

<section data-background="measure-meme.png" data-background-size="40%">
</section>
<section data-background="measure-problem.jpg">
</section>

<section data-background-color="#FFF" data-background-iframe="./Anscombe/index.html">
	<aside class="notes">
	Pour démarer en douceur
	les moyennes c'est bien mais c'est rarement suffisant
	</aside>
</section>
<section data-background-color="#FFF">
	<!--<img src="be_above_average.jpg" />-->
	<h3>DON'T BE MEAN BE ABOVE AVERAGE</h3>
	<img src="normal.png" width="70%" class="no_border_img" />
	<aside class="notes">
		Moyenne c'est surti utile lorsque les valeurs sont réparti suivant une loi normale
		C'est le cas quand on a des valeurs aléatoires
		Quand on parle de latences sur un sys informatique, ce n'est pas le cas, on a souvent des phénomènes d'accumulations, des valeurs
		 isolées, des valeurs très éloignées de la moyenne
	</aside>
</section>
<!--
<section data-background="brexit.png" data-background-size="80%">
	<aside class="notes">
		wikipedia
En statistiques, un histogramme est un graphique permettant de représenter la répartition d'une variable continue.
Un histogram c'est un outil graphique qui permet de représenter la répartition d'un ensemble de données
	</aside>	
</section>
-->
<section data-background="iosnoop_hist_full6.png" data-background-size="95%">

	<aside class="notes">
Les percentiles ?
Le principe on trie les données, ensuite on cherche les 100 valeurs qui permetttent de séparer les valeurs observées en 100 parts égales,
le 50eme => valeur médiane
	</aside>
</section>


<section data-background="iosnoop_hist_full6_bis.png" data-background-size="95%">

	<aside class="notes">
Les percentiles ?
Le principe on trie les données, ensuite on cherche les 100 valeurs qui permetttent de séparer les valeurs observées en 100 parts égales,
le 50eme => valeur médiane
	</aside>
</section>

<section>
	<table>
		<tr>
			<th>Site</th>
			<th>Requêtes</th>
			<th>(1 - 0.99^n) * 100%</th>
		</tr>
		<tr>
			<td>devoxx.fr</td>
			<td>139</td>
			<td>75%</td>
		</tr>
		<tr>
			<td>fnac.fr</td>
			<td>163</td>
			<td>81%</td>
		</tr>
		<tr>
			<td>voyages-sncf.com</td>
			<td>175</td>
			<td>83%</td>
		</tr>
		<tr>
			<td>lemonde.fr</td>
			<td>547</td>
			<td>99%</td>
		</tr>
	</table>
</section>

<section data-background-color="#FFF" data-background="hdr.example.png" data-background-size="100%">
	<h1>DEMO</h1>
</section>


<section data-transition="none">
	<h3>L'API</h3>
<pre><code data-trim data-noescape class="java">long before = System.nanoTime();

// ce que l'on mesure
SUT.call();                   

long duration = System.nanoTime() - before;

<mark>histogram.recordValue(duration);</mark></code></pre>
	<aside class="notes">
		Techniquement ce n'est pas simple'
			emprunte mémoire
			impact sur le cpu la latence
	</aside>
</section>

<section data-transition="none">
	<h3>L'API</h3>
	<pre><code data-trim data-noescape class="java">long before = System.nanoTime();

// ce que l'on mesure
SUT.call();                  

long duration = System.nanoTime() - before;

histogram.recordValue(duration);</code></pre>
	<aside class="notes">
	emprunte mémoire controlée
	pas d'allocation à l'enregistrement
	impact cpu faible (quelques nano secondes)
	</aside>
</section>

<section data-transition="none">
	<h3>L'API</h3>
	<pre><code data-trim data-noescape class="java">// initialisation
Histogram histogram = new Histogram(Long.MAX_VALUE,  3);

<mark>// enregistrement
histogram.recordValue(duration);

// consultation
histogram.getValueAtPercentile(99);
histogram.getValueAtPercentile(99.9);</mark></code></pre>
<aside class="notes">
	emprunte mémoire controlée
	pas d'allocation à l'enregistrement
	impact cpu faible (quelques nano secondes)
	</aside>

</section>

<section data-transition="none">
	<h3>L'API</h3>
	<pre><code data-trim data-noescape class="java">// initialisation
Histogram histogram = new Histogram(Long.MAX_VALUE,  3);

// enregistrement
histogram.recordValue(duration);

<mark>// consultation
histogram.getValueAtPercentile(99);
histogram.getValueAtPercentile(99.9);</mark></code></pre>

</section>

<section data-transition="none" data-state="firstDemoEnd">
	<h3>L'API</h3>
	<pre><code data-trim data-noescape class="java">// initialisation
Histogram histogram = new Histogram(Long.MAX_VALUE,  3);

// enregistrement
histogram.recordValue(duration);

// consultation
histogram.getValueAtPercentile(99);
histogram.getValueAtPercentile(99.9);</code></pre>

</section>


<section data-state="firstDemo" data-transition="none"><h3>DEMO JS</h3><pre><code data-trim data-noescape class="JavaScript">const histogram = hdr.build();
<mark>setInterval(() => {
  const before = performance.now();
  fetch("ping.json")
    .then(_ => {
      const latencyInMicro = floor((performance.now() - before) * 1000); // <span class="firstDemoLatencyInMicro"> NA </span> micro sec  
      histogram.recordValue(latencyInMicro);
    });
}, 100);

histogram.getTotalCount();            // <span class="firstDemoTotalCount">NA</span>
histogram.maxValue                    // <span class="firstDemoMaxValue">NA</span> micro sec
histogram.getValueAtPercentile(99.9); // <span class="firstDemoNNN">NA</span> micro sec
histogram.getValueAtPercentile(99);   // <span class="firstDemoNN">NA</span> micro sec
histogram.getValueAtPercentile(50);   // <span class="firstDemoMedian">NA</span> micro sec</mark></code></pre></section>

<section data-state="firstDemo" data-transition="none"><h3>DEMO JS</h3><pre><code data-trim data-noescape class="JavaScript">const histogram = hdr.build();
setInterval(() => {
  const before = performance.now();
  fetch("ping.json")
    .then(_ => {
      const latencyInMicro = floor((performance.now() - before) * 1000); // <span class="firstDemoLatencyInMicro">NA</span>  micro sec  
      histogram.recordValue(latencyInMicro);
    });
}, 100);

<mark>histogram.getTotalCount();            // <span class="firstDemoTotalCount">NA</span>
histogram.maxValue;                   // <span class="firstDemoMaxValue">NA</span> micro sec
histogram.getValueAtPercentile(99.9); // <span class="firstDemoNNN">NA</span> micro sec
histogram.getValueAtPercentile(99);   // <span class="firstDemoNN">NA</span> micro sec
histogram.getValueAtPercentile(50);   // <span class="firstDemoMedian">NA</span> micro sec</mark></code></pre></section>

<section data-state="firstDemo" data-transition="none"><h3>DEMO JS</h3><pre><code data-trim data-noescape class="JavaScript">const histogram = hdr.build();
setInterval(() => {
  const before = performance.now();
  fetch("ping.json")
    .then(_ => {
      const latencyInMicro = floor((performance.now() - before) * 1000); // <span class="firstDemoLatencyInMicro">NA</span>  micro sec  
      histogram.recordValue(latencyInMicro);
    });
}, 100);

histogram.getTotalCount();            // <span class="firstDemoTotalCount">NA</span>
histogram.maxValue                    // <span class="firstDemoMaxValue">NA</span> micro sec
histogram.getValueAtPercentile(99.9); // <span class="firstDemoNNN">NA</span> micro sec
histogram.getValueAtPercentile(99);   // <span class="firstDemoNN">NA</span> micro sec
histogram.getValueAtPercentile(50);   // <span class="firstDemoMedian">NA</span> micro sec</code></pre></section>


<section data-state="firstDemo" data-transition="none"><h3>DEMO JS</h3><pre><code data-trim data-noescape class="JavaScript">histogram.outputPercentileDistribution();


<span class="firstDemoOutput">NA</span></code></pre></section>



<section data-state="firstDemoEnd" data-transition="fade">
	<h1>Comment ça marche ?</h1>
</section>

<section data-background="numbers2.jpg">

</section>

<section  data-transition="fade-up">
	<p style="font-weight: small">"Internally, data in HdrHistogram variants is maintained using a concept somewhat similar to that of floating point number representation: Using an exponent a (non-normalized) mantissa to support a wide dynamic range at a high but varying (by exponent value) resolution. AbstractHistogram uses exponentially increasing bucket value ranges (the parallel of the exponent portion of a floating point number) with each bucket containing a fixed number (per bucket) set of linear sub-buckets (the parallel of a non-normalized mantissa portion of a floating point number). Both dynamic range and resolution are configurable, with highestTrackableValue controlling dynamic range, and numberOfSignificantValueDigits controlling resolution."</p>
<aside class="notes">
	garder toutes les valeurs, ce n'est pas jouable, la mémoire explose. Garder quelques valeurs mais pas d'autres ce n'est pas jouable 
	choisir ce que l'on garde et ce que l'on ignore, c'est un peu risqué si l'on veut au final des résultats un peu précis 

	Pour être honnete je n'ai tronqué le début
	Nitsan Wakart: Hmmm... I'll admit to having difficulty immediately understanding what's happening from the above text
</aside>
</section>



<section  data-transition="fade">
<h3>long counts[]</h3>		
<table>
	<tr>
		<td></td>
		<td></td>
		<td></td>
		<td></td>

		<td></td>
		<td></td>
		<td></td>
		<td><span class="fragment current-visible fade-left" data-fragment-index="2">7</span></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
	</tr>
</table>

<table>
	<tr>
		<td></td>
		<td></td>
		<td></td>
		<td></td>

		<td></td>
		<td></td>
		<td></td>
		<td><span class="fragment current-visible" data-fragment-index="3">+1</span></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
	</tr>
</table>

<table class="schema fragment" data-fragment-index="1">
	<tr>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		
	</tr>
</table>

</section>


<section data-transition="fade">
<h3>long counts[]</h3>
<table>
	<tr>
		<td>&nbsp;</td>
		<td></td>
		<td></td>
		<td></td>

		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
	</tr>
</table>

<table>
	<tr>
		<td>&nbsp;</td>
		<td></td>
		<td></td>
		<td></td>

		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
	</tr>
</table>

<table class="schema">
	<tr>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td><span style="font-weight: bold;">1</span></td>
		
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		
		<td>0</td>
		<td>0</td>
		<td>0</td>
		<td>0</td>
		
	</tr>
</table>

</section>



<section data-transition="fade">
<h3>long counts[]</h3>
<table>
	<tr>
		<td>&nbsp;</td>
		<td></td>
		<td></td>
		<td></td>

		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
	</tr>
</table>

<table>
	<tr>
		<td>&nbsp;</td>
		<td></td>
		<td></td>
		<td></td>

		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
	</tr>
</table>

<table class="schema">
	<tr>
		<td>0</td>
		<td>4</td>
		<td>1</td>
		<td>0</td>
		
		<td>3</td>
		<td>8</td>
		<td>4</td>
		<td>1</td>
		
		<td>9</td>
		<td>2</td>
		<td>1</td>
		<td>0</td>
		
		<td>0</td>
		<td>7</td>
		<td>2</td>
		<td>0</td>
		
	</tr>
</table>

</section>

<section align="left">
	<div style="margin: 0 20%">
		<h1>H<span class="fragment" data-fragment-index="1">igh</span></h1>
		<h1>D<span class="fragment" data-fragment-index="1">ynamic</span></h1>
		<h1>R<span class="fragment" data-fragment-index="1">ange</span></h1>
	</div>
</section>



<section data-transition="fade">
	<h1>123 000</h1>
</section>
<section data-transition="fade">
	<h1>123 999</h1>
</section>
<section data-transition="fade">
	<h1>123 042</h1>
</section>

<section>
	<h3>Buckets & Sub buckets</h3>
	<h3>&nbsp;</h3>
	
	
	<table class="schema">
					<tr>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>

						<td class="fragment fade-right" data-fragment-index="1">&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="fragment fade-right" data-fragment-index="1">&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="fragment fade-right" data-fragment-index="1">&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="fragment fade-right" data-fragment-index="1">&nbsp;&nbsp;&nbsp;&nbsp;</td>
						
						<td class="fragment fade-right" data-fragment-index="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="fragment fade-right" data-fragment-index="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="fragment fade-right" data-fragment-index="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="fragment fade-right" data-fragment-index="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						<td class="fragment fade-right" data-fragment-index="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
						

					</tr>
				</table>
	
</section>



<!--
<section>
	<table>
		<tr>
			<th>Chiffres significatifs</th>
			<th>Taille des buckets</th>
		</tr>
		<tr>
			<td>2</td>
			<td>256</td>
		</tr>
		<tr>
			<td>3</td>
			<td>2048</td>
		</tr>
		<tr>
			<td>5</td>
			<td>????</td>
		</tr>

	</table>

</section>
-->
<section data-transition="fade">

	new Histogram(<span style="font-weight: bold; color: red"> 3 </span>)

	<aside class="notes">
		3 facteurs pour tunner l'emprunte mémoire
		nb chiffres significatifs => taille des buckets
		3 => 2048 cases
		TODO la taille des buckets pour 5 chiffres significatifs
	</aside>

</section>

<!--
<section data-transition="fade">

<ul>
	<li>new Histogram(<span style="font-weight: bold"> 3 </span>)</li>
	<li class="fragment">new Histogram(<span style="font-weight: bold"> MAX_VALUE </span>, 3 )</li>
	<li class="fragment">new <span style="font-weight: bold">IntCounts</span>Histogram( MAX_VALUE , 3 )</li>
	<li class="fragment">new <span style="font-weight: bold">ShortCounts</span>Histogram( MAX_VALUE , 3 )</li>
</ul>
	<aside class="notes">
		3 facteurs pour tunner l'emprunte mémoire
		nb chiffres significatifs => taille des buckets
		3 => 2048 cases
		TODO la taille des buckets pour 5 chiffres significatifs
	</aside>

</section>
-->

<section data-transition="fade">
	new Histogram(<span style="font-weight: bold; color: red"> MAX_VALUE </span>, 3 )

	<aside class="notes">
		la valeur max observée => nombres de buckets à gérer et donc encore la taille du tableau de compteurs
	</aside>

</section>


<section data-transition="fade">
	new <span style="font-weight: bold; color: red">IntCounts</span>Histogram( MAX_VALUE , 3 )

	<aside class="notes">
		On divise par 2 par rapport aux longs
	</aside>

</section>


<section data-transition="fade">
	new <span style="font-weight: bold; color: red">ShortCounts</span>Histogram( MAX_VALUE , 3 )

	<aside class="notes">
		On divise par 2 par rapport aux longs
	</aside>

</section>


<section>
	new Histogram( Long.MAX_VALUE , 5 )

	<h1 class="fragment fade-up">49 Mo</h1>
	<aside class="notes">
des ordres de grandeur sur l'occupation mémoire
moi au début, le choix pépère
Imaginons que l'on mesure la latence d'un service en ms, que l'on timeout à 30secondes
	</aside>
</section>

<section>
	new IntCountsHistogram( 1000 * 30, 3 )

	<h1 class="fragment fade-up">25 Ko</h1>
	<aside class="notes">
En passant en plus à 3 chiffres significatifs, et en utilisant des integer pour gérer les compteurs à laplace des lons
	</aside>
</section>

<section>
	<h1>Un petit benchmark</h1>
</section>
<section>
	<pre><code data-trim data-noescape class="java">
for (int i = 0; i < nbLoop; i++) {

  long start = System.nanoTime();
  logger.info("New message - {}", i);
  histogram.recordValue((System.nanoTime() - start));

  Thread.sleep(1);

}
</code></pre>
</section>

<section>
	<img src="coordinated-omission.png" class="stretch no_border_img" />
</section>

<section data-transition="fade-in">
	<h3>Coordinated ommission</h3>
	<h3>&nbsp;</h3>
<table width="100%" class="no_border">
	<tr>
		<td width="10%" height="100" align="center" class="fragment simple_arrow" background="hand-drawn-arrow-2.png"></td>
		<td width="10%" height="100" align="center" class="fragment simple_arrow" background="hand-drawn-arrow-4.png"></td>
		<td width="10%" height="100" align="center" class="fragment simple_arrow" background="hand-drawn-arrow-2.png"></td>
		<td width="50%" height="100" align="center" class="fragment" style="background-size: 100% 100%" colspan="5" background="hand-drawn-arrow-3.png"></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
	</tr>
	<tr class="fragment">
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		
		<td width="10%" height="100" align="center" class="simple_arrow"></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		<td width="40%" height="100" align="right" class="simple_arrow" colspan="4" background="hand-drawn-arrow-4-dark-grey.png" style="background-position: right; background-size: 100% 100%"></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		
	</tr>
	
	<tr class="fragment">
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		
		<td width="10%" height="100" align="center" class="simple_arrow"></td>
		<td width="10%" height="100" align="center" class="simple_arrow"></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		<td width="30%" height="100" align="right" class="simple_arrow" colspan="3" background="hand-drawn-arrow-4-dark-grey.png" style="background-position: right; background-size: 100% 100%"></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		
	</tr>
	<tr class="fragment">
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		
		<td width="10%" height="100" align="center" class="simple_arrow"></td>
		<td width="10%" height="100" align="center" class="simple_arrow"></td>
		<td width="10%" height="100" align="center" class="simple_arrow"></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		<td width="20%" height="100" align="right" class="simple_arrow" colspan="2" background="hand-drawn-arrow-4-dark-grey.png" style="background-position: right; background-size: 100% 100%"></td>
		<td width="10%" height="100" align="center" class="simple_arrow" ></td>
		
	</tr>
	
</table>
</section>
<section>
	histogram.recordValueWithExpectedInterval(value, expectedInterval);
</section>
<section align="left" data-transition="fade-up">correctedHistogram =<br/>&nbsp;&nbsp;&nbsp;&nbsp;histogram.copyCorrectedForCoordinatedOmission(expectedInterval);
</section>
<section>
	<img src="coordinated-omission-schema.png" class="stretch" style="border: 0px;"/>
</section>

<section>
	<h1>jHiccup</h1>
	<h3>&nbsp;</h3>
	<p>java&nbsp;&nbsp;-javaagent:jHiccup.jar&nbsp;&nbsp;MyProgram</p>
</section>
<section>
	<img src="jhiccup-schema.png" class="stretch" style="border: 0px;"/>
	<p>&nbsp;</p>
</section>

<section>
DEMO
</section>


			</div>
		
		<div class="footer"><p style="color: white">#DevoxxFR</p><img align="right" src="logo-texte-devoxx-france-400.png" /></div>

		
			</div>


		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script src="lib/js/pako.min.js"></script>
		<script src="lib/js/hdrhistogram.min.js"></script>


		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				width: 1280,
 				height: 720,
 				margin: 0.0,


				controls: false,
				progress: false,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});

			let demoRunning = false;

			const forEachNode = (className, action) => (
				Array.from(document.getElementsByClassName(className)).forEach(action)
			);

			const { floor }  = Math; 

			const firstDemo = () => {
				const histogram = hdr.build();				
				return setInterval(() => {
  				const before = performance.now();
  				fetch(`ping.json?nocache=${before}`)
    				.then(_ => {
      				const latencyInMicro = floor((performance.now() - before) * 1000);
      				histogram.recordValue(latencyInMicro);
							forEachNode("firstDemoLatencyInMicro", elt => elt.innerHTML = `<span class='hljs-comment'>${latencyInMicro}</span>`);
							forEachNode("firstDemoTotalCount", elt => elt.innerHTML = `<span class='hljs-comment'>${histogram.getTotalCount()}</span>`);
							forEachNode("firstDemoMaxValue", elt => elt.innerHTML = `<span class='hljs-comment'>${floor(histogram.maxValue)}</span>`);
							forEachNode("firstDemoNNN", elt => elt.innerHTML = `<span class='hljs-comment'>${histogram.getValueAtPercentile(99.9)}</span>`);
							forEachNode("firstDemoNN", elt => elt.innerHTML = `<span class='hljs-comment'>${histogram.getValueAtPercentile(99)}</span>`);
							forEachNode("firstDemoMedian", elt => elt.innerHTML = `<span class='hljs-comment'>${histogram.getValueAtPercentile(50)}</span>`);
							forEachNode("firstDemoOutput", elt => elt.innerHTML = `<span class='hljs-comment'>${histogram.outputPercentileDistribution()}</span>`);

						});
				}, 100)
			}
			
			Reveal.addEventListener( 'firstDemo', function() {
				if (!demoRunning) {
					demoRunning = firstDemo();
				}
			} );

			Reveal.addEventListener( 'firstDemoEnd', function() {
    		clearInterval(demoRunning);
				demoRunning = false;
			} );

		</script>
	</body>
</html>
